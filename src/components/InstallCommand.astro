---
import CopyButton from './CopyButton.astro';

interface Props {
  class?: string;
}

const { class: className } = Astro.props;

const command = 'curl -fsSL https://raw.githubusercontent.com/whatiskadudoing/ralph-vibe/main/install.sh | sh';
---

<div class:list={['install-command-wrapper', className]} data-install-command>
  <div class="command-box">
    <span class="command-label" data-scramble>[curl]</span>
    <div class="code-wrapper">
      <code class="command-text">{command}</code>
      <CopyButton text={command} />
    </div>
  </div>
  <p class="method-note">Works on macOS, Linux, and WSL</p>
</div>

<style>
  .install-command-wrapper {
    width: 100%;
    overflow: visible;
  }

  .command-box {
    background: var(--void);
    border: 1px solid var(--concrete);
    border-radius: 8px;
    padding: var(--space-3) var(--space-4);
  }

  .command-label {
    display: inline-block;
    font-family: var(--font-mono);
    font-size: var(--text-code);
    color: var(--signal);
    margin-bottom: var(--space-2);
  }

  /* Code wrapper */
  .code-wrapper {
    display: flex;
    align-items: center;
    gap: var(--space-2);
  }

  .command-text {
    flex: 1;
    min-width: 0;
    font-family: var(--font-mono);
    font-size: clamp(0.75rem, 2vw, var(--text-code));
    color: var(--signal);
    white-space: nowrap;
    text-align: left;
    overflow-x: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--metal) var(--void);
  }

  .command-text::-webkit-scrollbar {
    height: 4px;
  }

  .command-text::-webkit-scrollbar-track {
    background: var(--void);
  }

  .command-text::-webkit-scrollbar-thumb {
    background: var(--metal);
    border-radius: 2px;
  }

  .code-wrapper :global(.copy-button) {
    flex-shrink: 0;
    background: var(--metal);
    border-color: var(--concrete);
    color: var(--text-primary);
  }

  .code-wrapper :global(.copy-button:hover) {
    background: var(--concrete);
    border-color: var(--metal);
    color: var(--signal);
  }

  /* Method note */
  .method-note {
    margin: var(--space-2) 0 0 0;
    font-size: var(--text-small);
    color: var(--text-tertiary);
    font-family: var(--font-mono);
    text-align: center;
  }

  /* Mobile adjustments */
  @media (max-width: 640px) {
    .command-box {
      padding: var(--space-3);
    }

    .code-wrapper {
      flex-direction: column;
      align-items: stretch;
      gap: var(--space-3);
    }

    .command-text {
      overflow-x: auto;
      padding-bottom: var(--space-2);
    }

    .code-wrapper :global(.copy-button) {
      width: 100%;
      justify-content: center;
    }
  }
</style>

<script>
  // Initialize scramble animation for install command
  document.querySelectorAll<HTMLElement>('[data-install-command]').forEach(wrapper => {
    setTimeout(() => {
      if (typeof (window as any).scrambleText === 'function') {
        const label = wrapper.querySelector('.command-label');
        const commandText = wrapper.querySelector('.command-text');
        const methodNote = wrapper.querySelector('.method-note');

        if (label) {
          const text = label.textContent || '';
          (window as any).scrambleText(label, text, { duration: 500 });
        }
        if (commandText) {
          const text = commandText.textContent || '';
          (window as any).scrambleText(commandText, text, { duration: 700 });
        }
        if (methodNote) {
          const text = methodNote.textContent || '';
          (window as any).scrambleText(methodNote, text, { duration: 500 });
        }
      }
    }, 100);
  });
</script>
